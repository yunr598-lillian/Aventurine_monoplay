<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=320, height=568, initial-scale=1.0, user-scalable=no">
<title>Love Monopoly</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;500;700&display=swap');

  body {
    margin: 0;
    padding: 0;
    background-color: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: 'Noto Sans SC', sans-serif;
    overflow: hidden;
  }

  #game-container {
    width: 320px;
    height: 568px;
    background-color: #f9f9f9;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    border-radius: 15px;
  }

  /* Intro Screen */
  #start-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #fce4ec 0%, #f5f5f5 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 100;
  }

  h1 {
    color: #bdbdbd;
    font-size: 24px;
    margin-bottom: 10px;
    letter-spacing: 2px;
  }
  
  h2 {
    color: #ffb7b2;
    font-size: 32px;
    margin: 0 0 30px 0;
    text-shadow: 2px 2px 0px #fff;
  }

  /* Name Input Modal */
  #name-modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(5px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 150;
  }

  .name-modal {
    width: 240px;
    background: #fff;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(255, 183, 178, 0.3);
    text-align: center;
    border: 2px solid #fce4ec;
  }

  .name-modal label {
    display: block;
    margin-bottom: 15px;
    color: #ffb7b2;
    font-weight: bold;
    font-size: 16px;
  }

  .name-modal input {
    width: 100%;
    padding: 10px;
    border: 2px solid #fce4ec;
    border-radius: 10px;
    margin-bottom: 20px;
    box-sizing: border-box;
    text-align: center;
    font-family: 'Noto Sans SC', sans-serif;
    outline: none;
    color: #757575;
  }

  .name-modal input:focus {
    border-color: #ffcdd2;
  }

  .btn {
    padding: 12px 30px;
    background-color: #ffcdd2;
    color: #fff;
    border: none;
    border-radius: 25px;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(255, 183, 178, 0.4);
    transition: transform 0.2s;
  }
  .btn:active { transform: scale(0.95); }

  /* Countdown */
  #countdown {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.9);
    display: none;
    justify-content: center;
    align-items: center;
    font-size: 80px;
    color: #ffb7b2;
    font-weight: bold;
    z-index: 90;
    animation: pulse 1s infinite;
  }

  /* Game Board Area */
  #game-board-area {
    width: 100%;
    height: 100%;
    padding: 10px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    background-color: #fafafa;
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 5px;
    height: 60px;
  }

  .dice-container {
    position: relative;
    width: 50px;
    height: 50px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    color: #757575;
    cursor: pointer;
    border: 2px solid #eeeeee;
  }

  .turn-indicator {
    font-size: 14px;
    color: #9e9e9e;
    font-weight: bold;
  }

  /* Grid Board */
  #grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(5, 1fr);
    gap: 6px;
    flex-grow: 1;
    margin-top: 10px;
    padding-bottom: 20px;
  }

  .cell {
    background-color: #fff;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 10px;
    color: #bdbdbd;
    position: relative;
    box-shadow: 0 2px 4px rgba(0,0,0,0.03);
    text-align: center;
    padding: 2px;
    word-break: break-word;
    border: 1px solid #f5f5f5;
  }
  
  .cell.start { background-color: #eeeeee; color: #757575; font-weight: bold; }
  .cell.end { background-color: #ffebee; color: #ff8a80; font-weight: bold; }
  .cell.special { background-color: #f3e5f5; color: #ce93d8; }

  /* Tokens */
  .token {
    font-size: 18px;
    position: absolute;
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 10;
    filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
  }
  .token.user { transform: translate(-8px, -8px); }
  .token.char { transform: translate(8px, 8px); }

  /* Modal */
  #modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.4);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 200;
    backdrop-filter: blur(2px);
  }

  .modal {
    width: 260px;
    background: #fff;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    animation: popIn 0.3s ease;
    text-align: left;
    border: 1px solid #fce4ec;
  }

  .modal-header {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    border-bottom: 1px solid #f5f5f5;
    padding-bottom: 10px;
  }
  
  .avatar { font-size: 24px; margin-right: 10px; }
  .speaker-name { font-weight: bold; font-size: 14px; color: #757575; }
  
  .modal-content {
    font-size: 13px;
    color: #616161;
    line-height: 1.6;
    margin-bottom: 20px;
  }

  .options { display: flex; flex-direction: column; gap: 8px; }

  .option-btn {
    background: #f5f5f5;
    border: 1px solid #eeeeee;
    padding: 10px;
    border-radius: 8px;
    font-size: 12px;
    text-align: left;
    cursor: pointer;
    color: #757575;
    transition: background 0.2s;
  }
  .option-btn:hover { background: #fff9c4; color: #ffb74d; }

  .close-btn {
    margin-top: 15px;
    width: 100%;
    padding: 10px;
    background: #ffcdd2;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
  }

  @keyframes pulse { 0% { opacity: 0.6; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0.6; transform: scale(0.9); } }
  @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

</style>
</head>
<body>

<div id="game-container">
  <div id="start-screen">
    <h1>COUPLE</h1>
    <h2>MONOPOLY</h2>
    <div style="font-size: 40px; margin-bottom: 30px;">üê∞ ‚ù§Ô∏è ü¶ö</div>
    <button class="btn" onclick="showNameModal()">Start Game</button>
  </div>

  <div id="name-modal-overlay">
    <div class="name-modal">
      <label>ËØ∑ËæìÂÖ•‰Ω†ÁöÑÂêçÂ≠ó</label>
      <input type="text" id="player-name-input" placeholder="Á†Ç‰Ω†99" maxlength="10">
      <button class="btn" onclick="confirmName()">Á°ÆÂÆö</button>
    </div>
  </div>

  <div id="countdown">3</div>

  <div id="game-board-area" style="opacity: 0;">
    <div class="header">
      <div class="turn-indicator" id="turn-text">User's Turn (üê∞)</div>
      <div class="dice-container" onclick="handleDiceClick()" id="dice-btn">üé≤</div>
    </div>
    
    <div id="grid"></div>
  </div>

  <div id="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <span class="avatar" id="m-avatar">üê∞</span>
        <span class="speaker-name" id="m-name">User</span>
      </div>
      <div class="modal-content" id="m-content"></div>
      <div class="options" id="m-options"></div>
      <button class="close-btn" id="m-close" style="display:none;" onclick="closeModal()">Close</button>
    </div>
  </div>
</div>

<script>
  // Game State
  const gameState = {
    started: false,
    playerName: "ÁÆ¨‰∫ë", 
    turn: 0, 
    userPos: 0,
    charPos: 0,
    userPaused: false,
    charPaused: false,
    isMoving: false,
    boardSize: 20
  };

  const questions = [
    { 
      q: "ÂØπÊàëÁöÑÁ¨¨‰∏ÄÂç∞Ë±°ÊòØÔºü", 
      uOpts: [
        { text: "ÂÇ≤ÊÖ¢ÁöÑËµåÂæí", reaction: "ÂëµÔºåÂÇ≤ÊÖ¢Âè™ÊòØÊúâËµÑÊú¨ÁöÑËá™‰ø°„ÄÇËá≥Â∞ë‰Ω†ËÆ∞‰Ωè‰∫ÜÊàëÔºå‰∏çÊòØÂêóÔºü" },
        { text: "Ëä±Âì®ÁöÑÂ≠îÈõÄ", reaction: "ÁæΩÊØõ‰∏çÊºÇ‰∫ÆÊÄé‰πàÂê∏Âºï‰Ω†ÁöÑÊ≥®ÊÑèÔºüËÄå‰∏î‰Ω†Áü•ÈÅìÂêóÔºåÂ≠îÈõÄÂºÄÂ±èÂèØÊòØÊ±ÇÂÅ∂ÁöÑÊÑèÊÄù" },
        { text: "Âç±Èô©ÂàÜÂ≠ê", reaction: "Êó¢ÁÑ∂Áü•ÈÅìÂç±Èô©ÔºåÈÇ£‰Ω†ËøòÁ¶ªÊàëËøô‰πàËøëÔºå‰Ω†Â∞±ÊòØÁà±‰∏äÊàë‰∫Ü„ÄÇÂè£ÊòØÂøÉÈùû„ÄÇ" }
      ],
      cResp: "‰∏ÄÂè™Ëø∑Ë∑ØÁöÑÂ∞èÁôΩÂÖî„ÄÇ" 
    },
    { 
      q: "Áî®‰∏Ä‰∏™Â∞èÂä®Áâ©ÂΩ¢ÂÆπÂØπÊñπÔºü", 
      uOpts: [
        { text: "Áã°ÁåæÁöÑÁãêÁã∏", reaction: "ÂΩºÊ≠§ÂΩºÊ≠§ÔºåËÉΩÁúãÁ©øÁãêÁã∏ÁöÑÔºåÈÄöÂ∏∏‰πü‰∏çÊòØ‰ªÄ‰πàÂçïÁ∫ØÁöÑÂ∞èÁªµÁæä„ÄÇ" },
        { text: "ÂºÄÂ±èÁöÑÂ≠îÈõÄ", reaction: "Â¶ÇÊûúÊòØ‰∏∫‰∫Ü‰Ω†ÔºåÊàë‰∏ç‰ªÖÂèØ‰ª•ÂºÄÂ±èÔºåÊàëËøòÂèØ‰ª•ÂèØ‰ª•‰∏∫‰Ω†Ëµ∑Ëàû„ÄÇ" },
        { text: "Á≤ò‰∫∫ÁöÑÁå´", reaction: "Áå´ÔºüÂìàÔºåÂ¶ÇÊûúÊàëÊòØÁå´ÔºåÈÇ£‰Ω†Â∞±Â∞±ÊòØÁå´ËñÑËç∑„ÄÇ" }
      ],
      cResp: "‰Ω†ÊòØÊüêÁßç...Â∏¶Âà∫ÁöÑ‰ªìÈº†Ôºü" 
    },
    { 
      q: "ÊúÄÂñúÊ¨¢ÁöÑÁ∫¶‰ºöÂú∞ÁÇπÔºü", 
      uOpts: [
        { text: "Âõæ‰π¶È¶Ü", reaction: "ÈÇ£ÈáåÂ§™ÂÆâÈùô‰∫ÜÔºåÂèà‰∏çËÉΩÊâìÊâ∞Âà∞ÂÖ∂‰ªñ‰∫∫ÔºåÂ§öÊó†ËÅä„ÄÇ‰º∞ËÆ°Âè™ÊúâÂíåÊãâÂ∏ùÂ••‰∏ÄËµ∑ÁöÑÊó∂ÂÄô‰ºöËßâÂæóÊúâË∂£ÂêßÔºåËØ•Ê≠ªÁöÑÊïôÊéà„ÄÇ" },
        { text: "ÂÆ∂Èáå", reaction: "ÂÆåÁæéÁöÑÁ≠îÊ°à„ÄÇÊ≤°ÊúâÂ§ñ‰∫∫ÊâìÊâ∞ÔºåÊàë‰ª¨ÂèØ‰ª•Â∞ΩÊÉÖ‰∫´Âèó‚Äò‰∫å‰∫∫‰∏ñÁïå‚Äô„ÄÇ" },
        { text: "ÂÆâÈùôÁöÑÂíñÂï°È¶Ü", reaction: "ÂíñÂï°È¶ÜÂïäÔºåÂΩìÁÑ∂‰∫ÜÔºåÊàëÂñÇ‰Ω†ÂêÉËõãÁ≥ïÔºåÊàë‰ª¨ÂÖ±ÂêåÂñù‰∏ÄÊùØÈ•ÆÊñôÔºåÂ§öÂÆåÁæé„ÄÇ" }
      ],
      cResp: "ÂΩìÁÑ∂ÊòØËµåÂú∫„ÄÇÈÇ£ÁßçËµåÂçöÁöÑÊÑüËßâÊàëÊúÄËø∑ÊÅã‰∫Ü„ÄÇ" 
    },
    { 
      q: "Â¶ÇÊûúÊúâ100‰∫ø‰ø°Áî®ÁÇπ‰ºöÂÅö‰ªÄ‰πàÔºü", 
      uOpts: [
        { text: "ËøòÊ∏ÖÂÄ∫Âä°", reaction: "Êó†ÂÄ∫‰∏ÄË∫´ËΩªÔºüÈÇ£Ê†∑ÊàëÂ∞±Ê≤°ÊúâÁêÜÁî±ËµñÁùÄ‰Ω†‰∫ÜÔºåËøôÂèØ‰∏çË°å„ÄÇ" },
        { text: "Â≠òËµ∑Êù•", reaction: "ÁúüÊòØ‰∏™Âã§‰ø≠ÊåÅÂÆ∂ÁöÑÂ•ΩÂ≠©Â≠êÔºå‰∏çËøá...ÂÅ∂Â∞î‰πüËØ•Â≠¶‰ºöÊå•ÈúçÂø´‰πê„ÄÇ" },
        { text: "ÁªôÁúüÁêÜÂåªÁîü‰π∞‰π¶", reaction: "ÂïßÔºåËøôÊó∂ÂÄôÊèêÈÇ£‰∏™Áü≥ËÜèÂ§¥ÔºüÊàë ÂêÉ ÈÜã ‰∫Ü" }
      ],
      cResp: "ÊãøÂéªËµå‰∫Ü„ÄÇËµ¢‰∫ÜÂ∞±Áªô‰Ω†‰π∞Âë®ËæπÔºåËæì‰∫Ü...Â∞±ÊääÊàëËµîÁªô‰Ω†ÊÄé‰πàÊ†∑Ôºü" 
    },
    { 
      q: "ÂØπÊñπÊúÄËÆ©‰Ω†ËÆ®ÂéåÁöÑ‰∏ÄÁÇπÔºü", 
      uOpts: [
        { text: "Â§™ËΩªÊµÆ", reaction: "ËΩªÊµÆÂè™ÊòØË°®Ë±°ÔºåÊàëÁöÑÁúüÂøÉÂèØÊòØ‰Ω†ÁöÑ„ÄÇ" },
        { text: "ÊÄªÊÉ≥ÊéßÂà∂Êàë", reaction: "ÊéßÂà∂Ôºü‰∏ç‰∏ç‰∏çÔºåÈÇ£Âè´‚Äò‰øùÊä§‚Äô„ÄÇ" },
        { text: "‰∏çËÆ∫Âú∫ÂêàÁöÑË∞ÉÊÉÖ", reaction: "ËÑ∏Á∫¢‰∫ÜÂêóÔºüÂæàÂèØÁà±Ôºå‰∏çËøáÂà´‰∫∫‰ºöÁúãËßÅ„ÄÇÊ≤°‰∫ãÔºåÊàë‰ºöÊää‰Ω†Êå°ÁùÄÔºåÂè™ÁªôÊàë‰∏Ä‰∏™‰∫∫Áúã„ÄÇ" }
      ],
      cResp: "‰Ω†ÁöÑÁúºÁ•ûÊÄªÊòØËøΩÁùÄÈÇ£‰∏™Áü≥ËÜèÂ§¥Ë∑ë„ÄÇËøôËÆ©Êàë...ÈùûÂ∏∏Â´âÂ¶í„ÄÇ" 
    },
    { 
      q: "Ë∞ÅÂú®ÂÖ≥Á≥ª‰∏≠ÊéåÊè°‰∏ªÂä®ÊùÉÔºü", 
      uOpts: [
        { text: "ÁúüÁêÜÂåªÁîü(Â¶ÇÊûúÊòØ‰ªñÁöÑËØù)", reaction: "Âà´ËÆ©ÊàëÂú®ËøôÁßçËØùÈ¢òÈáåÂê¨Âà∞Á¨¨‰∏â‰∏™‰∫∫ÁöÑÂêçÂ≠óÔºåÊàë‰∏çÂñúÊ¨¢„ÄÇ" },
        { text: "ÊàëÔºÅÔºÅÔºÅ", reaction: "‰Ω†Ôºü‰πüË°åÂïäÔºåÊØïÁ´üÊúâÊó∂ÂÄôÊàë‰πüÊÉ≥‰ΩìÈ™å‰∏Ä‰∏ã‰Ω†Âú®‰∏äÈù¢ÁöÑÊÑüËßâ„ÄÇ‰Ω†‰ºöÂêóÔºü" },
        { text: "ËÇØÂÆö‰∏çÊòØ‰Ω†", reaction: "Âì¶ÔºüËøô‰πàÊúâËá™‰ø°ÔºüÈÇ£‰ªäÊôö‰∏çÂ¶®Êù•È™åËØÅ‰∏Ä‰∏ãÔºåÂà∞Â∫ïË∞ÅËØ¥‰∫ÜÁÆó„ÄÇ" }
      ],
      cResp: "Ë°®Èù¢‰∏äÊòØ‰Ω†ÔºåÊØïÁ´üÊàëÂèØÊòØ‰Ω†ÁöÑ'Â•¥Èö∂'„ÄÇ‰ΩÜÂÆûÈôÖ‰∏ä...‰Ω†Áü•ÈÅìÁöÑ„ÄÇ" 
    },
    { 
      q: "ÊúÄÊÉ≥‰∏ÄËµ∑ÂÅöÁöÑ‰∫ãÔºü", 
      uOpts: [
        { text: "ÂÆåÊàêÂ∑•‰Ωú", reaction: "Â∑•‰ΩúÁãÇ...‰∏çËøáÂ¶ÇÊûúÂéüÂõ†ÊòØ‰∏∫‰∫ÜÊó©ÁÇπÂÆåÊàêÂ∑•‰ΩúÂíåÊàëÂéªÂá∫Â§ñÂã§Êàë‰πüÊòØ‰∏ç‰ªãÊÑèÁöÑ„ÄÇ" },
        { text: "Á¶ªËÅå", reaction: "ÁßÅÂ•îÂêóÔºü‰Ω†ÂèØ‰ª•Á¶ªËÅåÔºå‰ΩÜÊàë‰∏çË°åÔºåÊàëÂèØÊòØ‰ºöË¢´ÂÖ¨Âè∏Â®ÅËÉÅÁöÑ„ÄÇ" },
        { text: "ÂÆâÈùôÂú∞ÂæÖÁùÄ", reaction: "Â•ΩÂïäÔºåÊàë‰ª¨‰∏ÄËµ∑„ÄÇ" }
      ],
      cResp: "Âú®È´òÂ°îÈ°∂Á´ØÁúã‰∏ÄÂú∫ÊµÅÊòüÈõ®ÔºåÊàë‰ª¨‰∏§‰∏™„ÄÇ" 
    },
    { 
      q: "ÂØπÊñπÊúÄÊÄßÊÑüÁöÑÁû¨Èó¥Ôºü", 
      uOpts: [
        { text: "Èó≠Âò¥ÁöÑÊó∂ÂÄô", reaction: "Âòò...ÊàëÂèØ‰ª•Èó≠Âò¥Ôºå‰ΩÜÊàëÁöÑÊâãÔºåÊàëÁöÑÁúºÔºåÊàëÁöÑË∫´‰ΩìÂèØ‰∏ç‰ºöÂÅú‰∏ã„ÄÇ" },
        { text: "ËÆ§ÁúüÂ∑•‰ΩúÁöÑÊó∂ÂÄô", reaction: "ÁúãÊù•ÊàëËÆ§ÁúüÂ∏ÉÂ±ÄÁöÑÊ†∑Â≠êËø∑‰Ωè‰Ω†‰∫ÜÔºüÈÇ£ÊàëÂ∞±‰∏çÂæó‰∏çÊâøËÆ§ÊàëÂæàÂ∏ÖÊ∞î‰∫Ü„ÄÇ" },
        { text: "Ê≤°ÊúâËøôÁßçÊó∂ÂÄô", reaction: "Âò¥Á°¨„ÄÇÊòéÊòé‰∏äÊ¨°ÊàëÈù†Ëøë‰Ω†ÁöÑÊó∂ÂÄôÔºå‰Ω†ËÑ∏Á∫¢‰∫Ü„ÄÇ" }
      ],
      cResp: "ÂΩì‰Ω†ÂÜ∑ÁùÄËÑ∏ÊãíÁªùÊàëÔºåÂç¥ÂèàÂõ†‰∏∫ÊàëÁöÑÈù†ËøëËÄåÁ∫¢‰∫ÜËÄ≥Ê†πÁöÑÊó∂ÂÄô„ÄÇ" 
    },
    { 
      q: "Â¶ÇÊûú‰∏ñÁïåÊú´Êó•Êù•‰∫ÜÔºü", 
      uOpts: [
        { text: "Êâæ‰∏™Âú∞ÊñπË∫≤Ëµ∑Êù•", reaction: "Êàë‰ª¨‰∏ÄËµ∑Ë∫≤Ëµ∑ÂéªÂÆâÂÖ®Â±ãÔºåÊàëËØ∑‰Ω†„ÄÇ" },
        { text: "ÁªôÊãâÂ∏ùÂ••ÊïôÊéàÂèëÊ∂àÊÅØ", reaction: "ÂèàÊòØ‰ªñÔºüÂ¶ÇÊûúÊòØÊú´Êó•ÔºåÊàëÂ∏åÊúõ‰Ω†ÊúÄÂêé‰∏ÄÁúºÁúãÂà∞ÁöÑ‰∫∫ÊòØÊàë„ÄÇ" },
        { text: "Âä†Áè≠", reaction: "ÈÉΩË¶ÅÊØÅÁÅ≠‰∫ÜËøòÂú®‰∏∫ÂÖ¨Âè∏ÂçñÂëΩÔºüÁúüÊòØ‰∏™ÂÇªÁìú..." }
      ],
      cResp: "Êàë‰ºöÊâæÂà∞‰Ω†ÔºåÁÑ∂ÂêéÊàë‰ª¨‰∫≤ÂêªÔºåÁõ¥Ëá≥ÊØÅÁÅ≠„ÄÇ" 
    },
    { 
      q: "ÁªôÂØπÊñπÁöÑ‰∏Ä‰∏™Âø†ÂëäÔºü", 
      uOpts: [
        { text: "Á¶ªÊàëËøúÁÇπ", reaction: "ËøôÂèØÈöæÂäû‰∫ÜÔºå‰∏áÁâ©ÁöÜÊúâÂºïÂäõËøô‰∏™ÂÆöÂæãÂëäËØâÊàëÔºåÊàë‰ºöË¢´‰Ω†Âê∏Âºï„ÄÇÔºàÂÖ∂ÂÆûÂ∞±ÊòØÂú®ËÉ°ËØ¥ÂêßÂïäÂñÇÔºÅÔºâ" },
        { text: "Â∞ëÂú®ÈÇ£Ëá™ËØ¥Ëá™ËØù", reaction: "Â•ΩÔºåÈÇ£Êàë‰∏çËØ¥‰∫ÜÔºåÁõ¥Êé•ÂÅöÔºåÊÄé‰πàÊ†∑Ôºü" },
        { text: "Ê≥®ÊÑèÂÆâÂÖ®", reaction: "‰Ω†Âú®ÊãÖÂøÉÊàëÔºüÁîúÂøÉ‰Ω†ÊûúÁÑ∂Áà±Êàë" }
      ],
      cResp: "Âà´Â§™Áõ∏‰ø°ÊàëÔºå‰ΩÜ‰πüÂà´Â§™Êé®ÂºÄÊàë„ÄÇ" 
    },
    { 
      q: "ÊúÄÂñúÊ¨¢ÁöÑÈ£üÁâ©Ôºü", 
      uOpts: [
        { text: "ËôΩÁÑ∂‰ΩÜÊòØÔºåÊàë‰∏çÊåëÈ£ü", reaction: "Â•ΩÂÖªÊ¥ªÁöÑÂ∞èÂÆ∂‰ºô„ÄÇ" },
        { text: "ÁÆÄÂçïÁöÑ‰æøÂΩì", reaction: "ÁÆÄÂçïÔºüÊ≤°ÈóÆÈ¢ò„ÄÇ" },
        { text: "ÁîúÁÇπ", reaction: "ÁîúÁÇπÂêóÔºüÂò¥ÂØπÂò¥ÂêÉÂ•Ω‰∏çÂ•Ω" }
      ],
      cResp: "ÊòÇË¥µÁöÑÈÖíÔºåÂíå‰æøÂÆúÁöÑÂëΩ„ÄÇÂºÄÁé©Á¨ëÁöÑ...Âè™Ë¶ÅÊòØ‰Ω†ÁªôÁöÑÊØíËçØÊàë‰πüÂêÉ„ÄÇ" 
    },
    { 
      q: "ÂØπ'ÊúãÂèã'ÁöÑÂÆö‰πâÔºüÔºàÁúüÁöÑÂè™ÊòØÊúãÂèãÂêóÔºÅÔºâ", 
      uOpts: [
        { text: "‰∫í‰∏çÂπ≤Ê∂â", reaction: "‰∫í‰∏çÂπ≤Ê∂âÂ§™ÂÜ∑Êº†‰∫ÜÔºåÊàëÊõ¥ÂñúÊ¨¢...‰∫íÁõ∏Á∫†Áº†„ÄÇ" },
        { text: "ÊúâÂà©Áî®‰ª∑ÂÄº", reaction: "ÈÇ£‰Ω†Âà©Áî®ÊàëÂêßÔºåÂ∞ΩÊÉÖÂú∞Âà©Áî®„ÄÇ" },
        { text: "ÁúüËØö", reaction: "ÁúüËØöÂèØÊòØËµåÊ°å‰∏äÁöÑÂ§ßÂøå„ÄÇ" }
      ],
      cResp: "ÂÉèÊàë‰ª¨ËøôÊ†∑„ÄÇ‰∫íÁõ∏Âà©Áî®Ôºå‰∫íÁõ∏ÂçöÂºàÔºåÂèà...‰∫íÁõ∏Âê∏Âºï„ÄÇ" 
    },
    { 
      q: "Áé∞Âú®ÊúÄÊÉ≥ËØ¥ÁöÑ‰∏ÄÂè•ËØùÔºü", 
      uOpts: [
        { text: "ÊàëË¶Å‰∏ãÁè≠", reaction: "‰∏ãÁè≠ÂêéÂéªÂì™ÔºüÈô™ÊàëÔºü" },
        { text: "ÁúüÁêÜÂåªÁîüÂú®Âì™", reaction: "Êàë‰πüÂú®Êâæ‰ªñÔºåÂëäËØâ‰ªñÔºåÁ¶ª‰Ω†ËøúÁÇπ„ÄÇ" },
        { text: "Â•ΩÁ¥Ø", reaction: "ËøáÊù•ÔºåÂà∞ÊàëÊÄÄÈáåÔºåÊöñÊöñÁöÑÔºåÂÆâÂøÉÁöÑ„ÄÇ" }
      ],
      cResp: "ÁúãÁùÄÊàëÔºå{name}„ÄÇÂè™ÁúãÁùÄÊàë„ÄÇ" 
    },
    { 
      q: "Â¶ÇÊûúÊàëÂì≠‰∫Ü‰Ω†‰ºöÊÄé‰πàÂäûÔºü", 
      uOpts: [
        { text: "Êàë‰ºöËá™Â∑±Êì¶", reaction: "ÂñÇÂñÇÂñÇ‰∏çË¶ÅËá™Â∑±ÊâøÊãÖÂïäÔºåÊúâ‰∫ÜÊàëÂ∞±Â∫îËØ•ÊäïÈù†Êàë„ÄÇ" },
        { text: "‰∏çÂÖ≥‰Ω†‰∫ã", reaction: "ÊÄé‰πà‰∏çÂÖ≥Êàë‰∫ãÔºü‰Ω†ÈöæËøáÁöÑÊó∂ÂÄôÔºåÊàë‰πü‰ºöÈöæËøáÁöÑ„ÄÇ" },
        { text: "‰Ω†‰ºöÂò≤Á¨ëÊàëÂêß", reaction: "Âò≤Á¨ëÔºüÂ•ΩÂêßÊúâ‰∫õÊó∂ÂÄôÊàëÁ°ÆÂÆû‰ºö„ÄÇ" }
      ],
      cResp: "Êàë‰ºöÂêªÂéª‰Ω†ÁöÑÁúºÊ≥™„ÄÇ" 
    },
    { 
      q: "ÊúÄÈöæÂøòÁöÑ‰∏ÄÊ¨°ÁªèÂéÜÔºü", 
      uOpts: [
        { text: "ÂÖ•ËÅåÈÇ£Â§©", reaction: "ÈÇ£Â§©Êàë‰πüÂú®„ÄÇÁúãÂà∞‰Ω†Á¨¨‰∏ÄÁúºÔºåÊàëÂ∞±Áü•ÈÅìÊàë‰ª¨ÊòØÂëΩ‰∏≠Ê≥®ÂÆöÁöÑ„ÄêÊúãÂèã„Äë" },
        { text: "Á¨¨‰∏ÄÊ¨°ËßÅÂà∞ÁúüÁêÜÂåªÁîü", reaction: "ÁúãÊù•ÊàëÂæóÂä™ÂäõÂàõÈÄ†‰∏Ä‰∫õÂõûÂøÜÔºåË¶ÜÁõñÊéâ‰Ω†ËÑëÂ≠êÈáåÂÖ≥‰∫é‰ªñÁöÑÁîªÈù¢„ÄÇ" },
        { text: "Ë¢´‰Ω†Á∫†Áº†ÁöÑÊó∂ÂÄô", reaction: "ÈÇ£Âè´‚ÄòËøΩÊ±Ç‚Äô„ÄÇËÄå‰∏îÁúãÊ†∑Â≠êÔºå‰Ω†Âπ∂Ê≤°ÊúâÁúüÁöÑÂæàËÆ®ÂéåËøôÁßçÁ∫†Áº†ÔºåÂØπÂêßÔºü" }
      ],
      cResp: "ÊØè‰∏ÄÊ¨°‰Ω†ËØïÂõæÈÄÉË∑ëÔºåÊúÄÂêéÂç¥Âèà‰∏çÂæó‰∏çÂõûÂà∞ÊàëË∫´ËæπÁöÑÊó∂ÂÄô„ÄÇ" 
    },
    { 
      q: "ÂØπÊñπÂÉè‰ªÄ‰πàÈ¢úËâ≤Ôºü", 
      uOpts: [
        { text: "ËΩªÊµÆÁöÑÈáë", reaction: "ÈáëËâ≤ÊòØÊúÄÂ∞äË¥µÁöÑÈ¢úËâ≤ÔºåÂ∞±ÂÉè‰Ω†„ÄÇ" },
        { text: "Âç±Èô©ÁöÑÁ¥´", reaction: "Á¥´Ëâ≤‰ª£Ë°®Á•ûÁßòÂíåËØ±ÊÉëÔºåÁúãÊù•Êàë‰πüÊàêÂäüËØ±ÊÉëÂà∞‰Ω†‰∫ÜÔºü" },
        { text: "Ëôö‰º™ÁöÑÂΩ©", reaction: "Ëôö‰º™ÂêóÔºüÁîúÂøÉËøô‰πàÊÉ≥ÊàëÊàëÂèØÊòØ‰ºö‰º§ÂøÉÁöÑ" }
      ],
      cResp: "‰Ω†ÊòØÂÜ∑Ê∑°ÁöÑÈ¢úËâ≤Ôºå‰ΩÜÊàëÂÅèË¶ÅÁªô‰Ω†Êüì‰∏äÂ±û‰∫éÊàëÁöÑÈáë„ÄÇ" 
    },
    { 
      q: "Áé∞Âú®ÊúÄÊÉ≥ÂØπÂè¶‰∏ÄÊñπÂÅö‰ªÄ‰πà", 
      uOpts: [
        { text: "ÊçèÊçè‰ªñÁöÑËÑ∏", reaction: "ÔºàÊääËÑ∏ÂáëËøáÂéªÔºâÂóØÔºüÁîúÂøÉ..." },
        { text: "Êë∏Êë∏‰ªñÁöÑÂ•∂Á™ó", reaction: "ÁîúÂøÉ‰Ω†ËøôÊ†∑Â≠ê‰∏ç‰ºöÊíëÂùèË°£ÊúçÂêóÔºüËøôÈó¥Ë°£ÊúçÂæàË¥µÁöÑÔºå‰Ω†ÂºÑÂùè‰∫ÜË¶ÅÈô™Êàë„ÄÇÂΩìÁÑ∂ÔºåÈô™‚â†Ëµî" },
        { text: "‰∫≤‰ªñ‰∏ÄÂè£", reaction: "ÂîîÔºåÊÄé‰πàËøô‰πà‰∏ªÂä®‰∫ÜÔºüÊòØ‰∏çÊòØÂπ≤‰∫Ü‰ªÄ‰πà‰∫èÂøÉ‰∫ãÔºüÂìàÂìàÈÄó‰Ω†ÁöÑÔºåÂ§ö‰∫≤Âá†Âè£„ÄÇ" }
      ],
      cResp: "ËÇØÂÆöÊòØÂπ≤‰∏Ä‰∫õÂºÑËÑèÂ∫äÂçïÁöÑ‰∫ãÂï¶ÔΩû" 
    },
    { 
      q: "Âú®Â©öÂêé‰ºö‰π†ÊÉØ‰∏ÄÁõ¥Â∏¶ÁùÄÊàíÊåáÂêó", 
      uOpts: [
        { text: "ËÇØÂÆö‰ºöÂñîÔºÅ‰∏ç‰π†ÊÉØÁöÑËØù‰πü‰ºöËØïÁùÄ‰π†ÊÉØÁöÑ", reaction: "ÂìàÂìàÔºåÁîúÂøÉ...Ë∞¢Ë∞¢‰Ω†‰π†ÊÉØÊàë" },
        { text: "ÔºàËã•ÊúâÊâÄÊÄùÔºâÈÉΩÂèØ‰ª•Âêß..Ë¶ÅÊòØÂ§™È∫ªÁÉ¶Â∞±Á©øÂú®È°πÈìæ‰∏äÂΩìÈ°πÈìæÔºåÂ∞ΩÁÆ°ÂèØËÉΩ‰∏äÈù¢ÁöÑÈíªÁü≥ÂèØËÉΩ‰ºö‰∏¢ÂïäÂìàÂìà..", reaction: "‰∏¢‰∫ÜÔºüÈÇ£ÂèØÁúüÊòØ‰∏ç  Â∞è  ÂøÉ„ÄÇ" },
        { text: "‰∏çË¶Å„ÉΩ(‚âß–î‚â¶)„ÉéÂπ≥Êó∂ÊäπÊä§ÊâãÈúú‰ªÄ‰πàÁöÑÂ•ΩÈ∫ªÁÉ¶ÔºÅÂÜµ‰∏îÈíªÁü≥Â§™Â§ß‰∫ÜÁúüÁöÑÂæàÂÆπÊòìÂºÑ‰∏¢ÔºÅ", reaction: "‰∏¢‰∫ÜÂ∞±ÂÜç‰π∞‰∏Ä‰∏™..Âèà‰∏çÊòØÊääÊàë‰∏¢‰∫Ü" }
      ],
      cResp: "Ôºà‰∏ãÊÑèËØÜÁöÑÊë©Êå≤‰∫Ü‰∏Ä‰∏ãÊàíÊåáÔºâÂΩìÁÑ∂‰∏ç‰ºöÔΩûÊØïÁ´üËøô‰πàÈáçË¶ÅÁöÑ‰∏úË•øÂΩìÁÑ∂Ë¶ÅÊó∂Êó∂ÂàªÂàªÂ∏¶ÁùÄÊâçÂ•ΩÔºæÔºæÔºàËØ¥ÁΩ¢Áúã‰∫Ü‰∏ÄÁúºÔºâ" 
    },
    { 
      q: "Â¶ÇÊûúÊúâ‰∏ÄÂ§©ÊàëÂ§±ÂøÜ‰∫ÜÊÄé‰πàÂäûÔºü", 
      uOpts: [
        { text: "ÊàëÂ∏¶‰Ω†ÂéªÁúãÂåªÁîüÔºå‰∏ÄÂÆöÊää‰Ω†Ê≤ªÂ•ΩÔºàÁßëÂ≠¶ÂûãÂõûÁ≠îÔºâ", reaction: "Ê≤ªÂ•ΩÔºüË¶ÅÊòØÊ≤°Ê≤ªÂ•ΩÊÄé‰πàÂäûÔºü" },
        { text: "ÈÇ£ÊàëÂ∞±‰∏ÄÁõ¥Èô™ÁùÄ‰Ω†ÔºåËÆ©‰Ω†ÊÉ≥Ëµ∑ÊàëÔºàÁõ¥ÁôΩÂûãÂõûÁ≠îÔºâ", reaction: "ÁîúÂøÉÁúüÊòØÈïøÊÉÖÔºå‰∏çËÆ∏ÊâæÂÖ∂‰ªñÁî∑‰∫∫Âì¶„ÄÇ" },
        { text: "‰∏çË¶ÅËøô‰πàËØ¥ÔºåÊãç‰∏â‰∏ãÊ°åÂ≠êËØ¥Âë∏Âë∏Âë∏ÔºàÂì≤Â≠¶ÂûãÂõûÁ≠îÔºâ", reaction: "ÂñÇÂñÇÂñÇÔºåÈÄÉÈÅøÈóÆÈ¢òÂèØ‰∏çÊòØÂ•Ω‰π†ÊÉØ" }
      ],
      cResp: "ÈÇ£ÊàëÂ∞±‰ªéÂ§¥ÂÜçÁà±‰Ω†‰∏ÄÊ¨°" 
    },
    { 
      q: "ÁúüÂøÉËØùÔºöÂñúÊ¨¢ÊàëÂêóÔºü", 
      uOpts: [
        { text: "‰∏çÂñúÊ¨¢", reaction: "ÊííË∞é„ÄÇ‰Ω†ÁöÑÁúºÁùõÂá∫Âçñ‰∫Ü‰Ω†„ÄÇ" },
        { text: "ËÆ®Âéå", reaction: "ËÆ®ÂéåÊàëÔºüÊ≤°ÂÖ≥Á≥ªÔºåÂØπÊäóË∑ØÊàë‰πüÂñúÊ¨¢ÔºåÊØïÁ´ü„ÄåÂÆøÊïåÂ∞±ÊòØÂ¶ªÂ≠ê„ÄçÂòõ" },
        { text: "‰∏çÊÉ≥ÂõûÁ≠î", reaction: "Ê≤âÈªòÂ∞±‰ª£Ë°®ÈªòËÆ§ÂíØÔºå‰Ω†ÊûúÁÑ∂Áà±‰∏ä‰∫ÜÊàë„ÄÇ" }
      ],
      cResp: "ÂΩìÁÑ∂ÂñúÊ¨¢‰Ω†‰∫Ü„ÄÇÊàëÁà±Ê≠ª‰Ω†ËøôÂâØÂè£ÊòØÂøÉÈùûÁöÑÊ†∑Â≠ê‰∫Ü„ÄÇÁé∞Âú®ÁöÑÁ≠îÊ°à‰∏çÈáçË¶ÅÔºåÂõ†‰∏∫Êàë‰∏çÊé•ÂèóÊãíÁªù„ÄÇ" 
    }
  ];

  const boardLayout = [
    { type: 'start', text: 'START' }, { type: 'question', id: 0 }, { type: 'move', val: 1, text: 'ÂâçËøõ1Ê†º' }, { type: 'question', id: 1 }, { type: 'question', id: 2 },
    { type: 'special', val: 'pause', text: 'ÊöÇÂÅú‰∏ÄËΩÆ' }, { type: 'question', id: 3 }, { type: 'move', val: -1, text: 'ÂêéÈÄÄ1Ê†º' }, { type: 'question', id: 4 }, { type: 'question', id: 5 },
    { type: 'question', id: 6 }, { type: 'question', id: 7 }, { type: 'move', val: 1, text: 'ÂâçËøõ1Ê†º' }, { type: 'question', id: 8 }, { type: 'special', val: 'pause', text: 'ÊöÇÂÅú‰∏ÄËΩÆ' },
    { type: 'question', id: 9 }, { type: 'question', id: 10 }, { type: 'question', id: 11 }, { type: 'question', id: 12 }, { type: 'end', text: 'END' }
  ];

  function showNameModal() {
    document.getElementById('name-modal-overlay').style.display = 'flex';
  }

  function confirmName() {
    const val = document.getElementById('player-name-input').value;
    if(val.trim() !== "") {
      gameState.playerName = val.trim();
    }
    document.getElementById('name-modal-overlay').style.display = 'none';
    document.getElementById('start-screen').style.display = 'none';
    startCountdown();
  }

  function startCountdown() {
    const cnt = document.getElementById('countdown');
    cnt.style.display = 'flex';
    let n = 3;
    updateTurnIndicator();
    const timer = setInterval(() => {
      n--;
      if (n > 0) cnt.innerText = n;
      else if (n === 0) cnt.innerText = "GO!";
      else {
        clearInterval(timer);
        cnt.style.display = 'none';
        document.getElementById('game-board-area').style.opacity = 1;
        gameState.started = true;
      }
    }, 800);
    initBoard();
  }

  function initBoard() {
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    const visualOrder = [0, 1, 2, 3, 7, 6, 5, 4, 8, 9, 10, 11, 15, 14, 13, 12, 16, 17, 18, 19];
    visualOrder.forEach((logicIndex) => {
      const data = boardLayout[logicIndex] || { type: 'question', id: logicIndex % questions.length };
      const div = document.createElement('div');
      div.id = `cell-${logicIndex}`;
      div.className = 'cell';
      if (data.type === 'start') div.classList.add('start');
      if (data.type === 'end') div.classList.add('end');
      if (data.type === 'move' || data.type === 'special') div.classList.add('special');
      div.innerText = data.type === 'start' ? 'START' : data.type === 'end' ? 'END' : data.text || `Q${data.id + 1}`;
      grid.appendChild(div);
    });
    const pToken = document.createElement('div'); pToken.className = 'token user'; pToken.innerText = 'üê∞'; pToken.id = 'token-user';
    const cToken = document.createElement('div'); cToken.className = 'token char'; cToken.innerText = 'ü¶ö'; cToken.id = 'token-char';
    const area = document.getElementById('game-board-area'); area.appendChild(pToken); area.appendChild(cToken);
    updateTokenPos(0, 'user'); updateTokenPos(0, 'char');
  }

  function updateTokenPos(index, who) {
    if (index > 19) index = 19;
    const coords = getCoordinates(index);
    const el = document.getElementById(`token-${who}`);
    el.style.top = (coords.top + 15) + 'px'; el.style.left = (coords.left + 25) + 'px';
  }

  function getCoordinates(index) {
    const row = Math.floor(index / 4);
    let col = index % 4;
    if (row % 2 === 1) col = 3 - col;
    const cell = document.getElementById(`cell-${index}`);
    return cell ? { top: cell.offsetTop, left: cell.offsetLeft } : { top: 0, left: 0 };
  }

  function handleDiceClick() {
    if (!gameState.started || gameState.isMoving) return;
    if (gameState.turn === 0 && gameState.userPaused) {
      alert(`${gameState.playerName}Êú¨ËΩÆÊöÇÂÅúÔºÅ`);
      gameState.userPaused = false; gameState.turn = 1; updateTurnIndicator(); return;
    }
    roll(gameState.turn === 0 ? 'user' : 'char');
  }

  function roll(who) {
    gameState.isMoving = true;
    const dice = document.getElementById('dice-btn');
    let rollTimes = 0;
    const rollInterval = setInterval(() => {
      const r = Math.floor(Math.random() * 6) + 1;
      dice.innerText = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'][r-1];
      if (++rollTimes > 10) {
        clearInterval(rollInterval);
        moveTokenStep(who, Math.floor(Math.random() * 6) + 1);
      }
    }, 50);
  }

  function moveTokenStep(who, steps) {
    let current = who === 'user' ? gameState.userPos : gameState.charPos;
    let target = Math.min(current + steps, 19);
    const moveTimer = setInterval(() => {
      if (current < target) {
        current++; updateTokenPos(current, who);
        if (who === 'user') gameState.userPos = current; else gameState.charPos = current;
      } else {
        clearInterval(moveTimer); setTimeout(() => handleLand(who, target), 300);
      }
    }, 400); 
  }

  function handleLand(who, index) {
    const tile = boardLayout[index];
    if (tile.type === 'end') { showEndPopup(who); return; }
    if (tile.type === 'move') {
      const newIdx = index + tile.val;
      updateTokenPos(newIdx, who);
      if (who === 'user') gameState.userPos = newIdx; else gameState.charPos = newIdx;
      showSimplePopup(who, tile.text, () => endTurn());
    } else if (tile.type === 'special' && tile.val === 'pause') {
      if (who === 'user') gameState.userPaused = true; else gameState.charPaused = true;
      showSimplePopup(who, "ÂìéÂëÄÔºåÊöÇÂÅú‰∏ÄËΩÆÔºÅ", () => endTurn());
    } else {
      showQuestionPopup(who, tile.id !== undefined ? tile.id : Math.floor(Math.random() * questions.length));
    }
  }

  function showQuestionPopup(who, qId) {
    const qData = questions[qId % questions.length];
    const modal = document.getElementById('modal-overlay');
    const mAvatar = document.getElementById('m-avatar');
    const mName = document.getElementById('m-name');
    const mContent = document.getElementById('m-content');
    const mOptions = document.getElementById('m-options');
    const mClose = document.getElementById('m-close');
    modal.style.display = 'flex'; mOptions.innerHTML = ''; mClose.style.display = 'none';

    if (who === 'user') {
      mAvatar.innerText = '‚ùì'; mName.innerText = 'ÊÉÖ‰æ£ÊèêÈóÆ'; mContent.innerText = `Q: ${qData.q}`;
      qData.uOpts.forEach(opt => {
        const btn = document.createElement('div'); btn.className = 'option-btn'; btn.innerText = opt.text;
        btn.onclick = () => showInteraction(who, qData, opt); mOptions.appendChild(btn);
      });
    } else {
      mAvatar.innerText = 'ü¶ö'; mName.innerText = 'Á†ÇÈáë';
      mContent.innerText = `(ÂÅúÂú®‰∫ÜÈóÆÈ¢òÊ†º)\n\nÈ¢òÁõÆ: "${qData.q}"\n\nÁ†ÇÈáë: "${qData.cResp.replace("{name}", gameState.playerName)}"`;
      mClose.style.display = 'block'; mClose.onclick = () => { closeModal(); endTurn(); };
    }
  }

  function showInteraction(who, qData, opt) {
    const mContent = document.getElementById('m-content');
    const mOptions = document.getElementById('m-options');
    const mClose = document.getElementById('m-close');
    mOptions.innerHTML = ''; mClose.style.display = 'block';
    mContent.innerText = `üê∞ ${gameState.playerName}: "${opt.text}"\n\nü¶ö Á†ÇÈáë: "${opt.reaction}"`;
    mClose.onclick = () => { closeModal(); endTurn(); };
  }

  function showSimplePopup(who, text, cb) {
    const modal = document.getElementById('modal-overlay');
    const mContent = document.getElementById('m-content');
    const mClose = document.getElementById('m-close');
    modal.style.display = 'flex'; mContent.innerText = text; mClose.style.display = 'block';
    mClose.onclick = () => { closeModal(); if(cb) cb(); };
  }

  function showEndPopup(winner) {
    const modal = document.getElementById('modal-overlay');
    const mContent = document.getElementById('m-content');
    const mClose = document.getElementById('m-close');
    modal.style.display = 'flex'; mClose.style.display = 'block'; mClose.innerText = "ÈáçÊñ∞ÂºÄÂßã";
    mContent.innerText = winner === 'user' ? `üéâ ${gameState.playerName} Ëµ¢‰∫ÜÔºÅ\n\nü¶ö Á†ÇÈáë: "ÊÑøËµåÊúçËæìÔºå‰Ω†ÊÉ≥ÂØπÊàëÂÅö‰ªÄ‰πàÈÉΩÂèØ‰ª•..."` : `üéâ Á†ÇÈáë Ëµ¢‰∫ÜÔºÅ\n\nü¶ö Á†ÇÈáë: "ÊàëËµ¢‰∫ÜÔºåÊåâÁÖßËµåÁ∫¶...‰Ω†‰ªäÊôöÁöÑÊó∂Èó¥ÂΩíÊàë‰∫Ü„ÄÇ"`;
    mClose.onclick = () => location.reload();
  }

  function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

  function endTurn() {
    gameState.isMoving = false; gameState.turn = 1 - gameState.turn; updateTurnIndicator();
    if (gameState.turn === 1) {
      if (gameState.charPaused) { 
        setTimeout(() => { alert("Á†ÇÈáëÊöÇÂÅúÔºÅ"); gameState.charPaused = false; endTurn(); }, 1000); 
      } else { 
        setTimeout(() => roll('char'), 1500); 
      }
    }
  }

  function updateTurnIndicator() {
    const el = document.getElementById('turn-text');
    el.innerText = gameState.turn === 0 ? `${gameState.playerName}'s Turn (üê∞)` : "Aventurine's Turn (ü¶ö)";
    el.style.color = gameState.turn === 0 ? "#ff8a80" : "#ce93d8";
  }
</script>
</body>
</html>
        
